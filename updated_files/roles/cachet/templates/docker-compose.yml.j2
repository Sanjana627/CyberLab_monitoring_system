services:
  postgres:
    image: postgres:14
    restart: unless-stopped
    environment:
      POSTGRES_USER: cachet
      POSTGRES_PASSWORD: {{ cachet_db_password }}
      POSTGRES_DB: cachet
    volumes:
      - db:/var/lib/postgresql/data

  cachet:
    image: cachethq/cachet:latest
    depends_on: [postgres]
    restart: unless-stopped
    environment:
      DB_DRIVER: pgsql
      DB_HOST: postgres
      DB_DATABASE: cachet
      DB_USERNAME: cachet
      DB_PASSWORD: {{ cachet_db_password }}
      APP_KEY: {{ cachet_app_key }}
      APP_URL: http://10.0.8.126:8080
    ports: [ "8080:8000" ]
    volumes: [ "cachet_storage:/var/www/html/storage" ]

volumes:
  db:
  cachet_storage:
